<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>grafitus:To-Do</id>
	<version>2.0</version>
	<file name="$boarddir/index.php">
		<operation>
			<search position="replace"><![CDATA[		'theme' => array('Themes.php', 'ThemesMain'),]]></search>
			<add><![CDATA[		'theme' => array('Themes.php', 'ThemesMain'),
		'todo' => array('To-DoList.php', 'ToDo'),]]></add>
		</operation>
	</file>
	<file name="$sourcedir/ManagePermissions.php">
		<operation>
			<search position="replace"><![CDATA[			'karma_edit' => array(false, 'general', 'moderate_general'),]]></search>
			<add><![CDATA[			'karma_edit' => array(false, 'general', 'moderate_general'),
			'view_todo' => array(false, 'general', 'view_todolist'),
			'add_new_todo' => array(false, 'general', 'add_new_todolist'),]]></add>
		</operation>
	</file>
	<file name="$sourcedir/Subs.php">
		<operation>
			<search position="replace"><![CDATA[	$context['allow_memberlist'] = allowedTo('view_mlist');]]></search>
			<add><![CDATA[	$context['allow_memberlist'] = allowedTo('view_mlist');
	$context['allow_view_todolist'] = allowedTo('view_todo');]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[			'mlist' => array(
				'title' => $txt['members_title'],]]></search>
			<add><![CDATA[			'todo' => array(
				'title' => function_exists('get_today_todos') ? get_today_todos() :  '',
				'href' => $scripturl . '?action=todo',
				'show' => $context['allow_view_todolist'],
				'sub_buttons' => array(
					'add' => array(
						'title' => $txt['to_do_add'],
						'href' => $scripturl . '?action=todo;sa=add',
						'show' => allowedTo('add_new_todo'),
						'is_last' => true,
					),
				),
			),
			'mlist' => array(
				'title' => $txt['members_title'],]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[?>]]></search>
			<add><![CDATA[function get_today_todos()
{
	global $txt, $smcFunc;

	$month = date('n');
	$day = date('j');

	$request = $smcFunc['db_query']('', '
		SELECT COUNT(duedate)
		FROM {db_prefix}to_dos
		WHERE is_did = {int:is_did}
			AND MONTH(duedate) = {int:month}
			AND DAYOFMONTH(duedate) = {int:day}
			AND YEAR(duedate) > {int:year}',
		array(
			'is_did' => 0,
			'year' => 1,
			'month' => $month,
			'day' => $day,
		)
	);
	list($todays_todos) = $smcFunc['db_fetch_row']($request);
	$smcFunc['db_free_result']($request);

	return $txt['to_do'] . ' [<strong>' . $todays_todos . '</strong>]';
}

?>]]></add>
		</operation>
	</file>
	<file name="$languagedir/Modifications.english.php">
		<operation>
			<search position="end" />
			<add><![CDATA[$txt['to_do'] = 'To-Do List';
$txt['to_do_actions'] = 'Actions';
$txt['to_do_empty'] = !$context['user']['is_admin'] ? 'To-Do List is empty!' : 'To-Do List is empty! Are you free man? :)';
$txt['to_do_del'] = 'Delete';
$txt['to_do_subject'] = 'Subject';
$txt['to_do_due_time'] = 'Due date';
$txt['to_do_due_year'] = 'Year (YYYY)';
$txt['to_do_due_month'] = 'Month (MM)';
$txt['to_do_due_day'] = 'Day (DD)';
$txt['to_do_priority'] = 'Priority';
$txt['to_do_priority0'] = 'Low';
$txt['to_do_priority1'] = 'Normal';
$txt['to_do_priority2'] = 'High';
$txt['to_do_add'] = 'Add';
// Permissions
$txt['permissionname_view_todo'] = 'View To-Do List';
$txt['permissionhelp_view_todo'] = 'This permission allows users to view To-Do List.';
$txt['permissionname_add_new_todo'] = 'Can add new to-do(s)';
$txt['permissionhelp_add_new_todo'] = 'This permission allows users to can add new To-Do(s).';
// Errors
$txt['to_do_empty_fields'] = 'You left the subject/due date field(s) empty.';
$txt['cannot_view_todolist'] = 'Sorry, but you aren\'t allowed to view To-Do List.';
$txt['cannot_add_new_todolist'] = 'Sorry, but you aren\'t allowed to add new To-Do(s).';]]></add>
		</operation>
	</file>
	<file name="$languagedir/Modifications.turkish.php">
		<operation>
			<search position="end" />
			<add><![CDATA[$txt['to_do'] = 'Yapýlacak Listesi';
$txt['to_do_actions'] = 'Ýþlemler';
$txt['to_do_empty'] = 'Yapýlacak listesi boþ.';
$txt['to_do_add'] = 'Yeni yapýlacak notu ekle';
$txt['to_do_del'] = 'Sil';
$txt['to_do_subject'] = 'Konu';
$txt['to_do_due_time'] = 'Sonlanma Tarihi';
$txt['to_do_due_year'] = 'Yýl (YYYY)';
$txt['to_do_due_month'] = 'Ay (MM)';
$txt['to_do_due_day'] = 'Gün (DD)';
$txt['to_do_priority'] = 'Öenm';
$txt['to_do_priority0'] = 'Düþük';
$txt['to_do_priority1'] = 'Normal';
$txt['to_do_priority2'] = 'Yüksek';
$txt['to_do_add'] = 'Ekle';
// Permissions
$txt['permissionname_view_todo'] = 'Yapýacal Listesi\'ni görebilir';
$txt['permissionhelp_view_todo'] = 'Bu izin, kullanýcýlarýn Yapýlacak Listesi\'ni görebilmerine olanak tanýr.';
$txt['permissionname_add_new_todo'] = 'Yeni yapýlacak notlarý ekleyebilir';
$txt['permissionhelp_add_new_todo'] = 'Bu izin, kullanýcýlarýn Yapýlacak Listesi\'ne yeni yapýlacak notlarý ekleyebilmelerine olanak tanýr.';
// Errors
$txt['to_do_empty_fields'] = 'Konu/Sonlanma Tarihi alanýný boþ býraktýnýz.';
$txt['cannot_view_todolist'] = 'Yapýlacak Listesi\'ni göremezsiniz.';
$txt['cannot_add_new_todolist'] = 'Yapýlacak Listesi\'ne yeni yapýlacak notlarý ekleyemezsiniz.';]]></add>
		</operation>
	</file>
	
</modification>