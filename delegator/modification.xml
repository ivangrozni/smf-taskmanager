<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>Iskra:Delegator</id>
	<version>0.1</version>
	<file name="$boarddir/index.php">
		<operation>
			<search position="replace"><![CDATA['theme' => array('Themes.php', 'ThemesMain'),]]></search>
			<add><![CDATA['theme' => array('Themes.php', 'ThemesMain'),
				'delegator' => array('Delegator.php', 'Delegator'),]]></add>
		</operation>
	</file>
	<!--
	<file name="$sourcedir/ManagePermissions.php">
		<operation>
			<search position="replace"><![CDATA[			'karma_edit' => array(false, 'general', 'moderate_general'),]]></search>
			<add><![CDATA[			
            'karma_edit' => array(false, 'general', 'moderate_general'),
			'view_todo' => array(false, 'general', 'view_todolist'),
			'add_new_todo' => array(false, 'general', 'add_new_todolist'),]]></add>
		</operation>
	</file>
	-->
	<file name="$sourcedir/Subs.php">
		<!--
		<operation>
			<search position="replace"><![CDATA[	$context['allow_memberlist'] = allowedTo('view_mlist');]]></search>
			<add><![CDATA[	$context['allow_memberlist'] = allowedTo('view_mlist');
            $context['allow_view_todolist'] = allowedTo('view_todo');]]></add>
		</operation>
		-->
		<operation>
			<search position="replace"><![CDATA['mlist' => array(]]></search>
			<add><![CDATA['delegator' => array(
				'title' => function_exists('get_today_todos') ? get_today_todos() :  'DELEGATOR TODAY PLACEHOLDER',
				'href' => $scripturl . '?action=delegator',
				'show' => $context['allow_memberlist'], // @TODO: proper permission
				'sub_buttons' => array(
					'add' => array(
						'title' => $txt['delegator_add'],
						'href' => $scripturl . '?action=delegator;sa=add',
						'show' => allowedTo('add_new_todo'),	// @TODO: proper permission
						'is_last' => true,
					),
                                        'add_proj' => array(
                                            'title' => $txt['delegator_add_proj'],
                                            'href' => $scripturl . '?action=delegator;sa=add_proj',
                                            'show' => allowedTo('add_new_todo'),
                                            'is_last' => true
                                        ),
				),
			),
'mlist' => array(]]></add>
<!-- 
kje se naredi dropdown menu - na neki tocki je izginila opcija Add 
edina, ki je delala za dodajanje...
Na starem testforumu dela, na novem forum_kopija pa ne!
Zelel sem sam popravit 
-->               

<!--    <add><![CDATA['delegator' => array(
				'title' => function_exists('get_today_todos') ? get_today_todos() :  'DELEGATOR TODAY PLACEHOLDER',
				'href' => $scripturl . '?action=delegator',
				'show' => $context['allow_memberlist'], // @TODO: proper permission
				'sub_buttons' => array(
					'add' => array(
						'title' => $txt['delegator_add_proj'],
						'href' => $scripturl . '?action=delegator;sa=add_proj',
						'show' => allowedTo('add_new_todo'),	// @TODO: proper permission
						'is_last' => true,
					),
				),
			),
'mlist' => array(]]></add> -->

		</operation>
		<operation>
			<search position="replace"><![CDATA[?>]]></search>
			<add><![CDATA[function get_today_todos()
{
	global $txt, $smcFunc;

	/*$month = date('n');
	$day = date('j');

	$request = $smcFunc['db_query']('', '
		SELECT COUNT(deadline)
		FROM {db_prefix}to_dos
		WHERE is_did = {int:is_did}
			AND MONTH(deadline) = {int:month}
			AND DAYOFMONTH(deadline) = {int:day}
			AND YEAR(deadline) > {int:year}',
		array(
			'is_did' => 0,
			'year' => 1,
			'month' => $month,
			'day' => $day,
		)
	);
	list($todays_todos) = $smcFunc['db_fetch_row']($request);
	$smcFunc['db_free_result']($request);

	return $txt['delegator'] . ' [<strong>' . $todays_todos . '</strong>]';*/
	
	return 'Delegator: <strong>Spread communism</strong>';
}
?>]]></add>
		</operation>
	</file>
	<file name="$languagedir/Modifications.english.php">
		<operation>
			<search position="end" />
			<add><![CDATA[$txt['delegator'] = 'Delegator';
$txt['delegator_actions'] = 'Actions';
$txt['delegator_empty'] = !$context['user']['is_admin'] ? 'To-Do List is empty!' : 'To-Do List is empty! Are you free man? :)';
$txt['delegator_del'] = 'Delete';
$txt['delegator_subject'] = 'Subject';
$txt['delegator_due_time'] = 'Due date'; <!-- ven se mi zdi -->
$txt['delegator_deadline'] = 'Deadline';
$txt['delegator_due_year'] = 'Year (YYYY)';
$txt['delegator_due_month'] = 'Month (MM)';
$txt['delegator_due_day'] = 'Day (DD)';
$txt['delegator_priority'] = 'Priority';
$txt['delegator_priority0'] = 'Low';
$txt['delegator_priority1'] = 'Normal';
$txt['delegator_priority2'] = 'High';
$txt['task_name'] = 'Task name';
$txt['task_desc'] = 'Task description';
$txt['delegator_add'] = 'Add';
$txt['delegator_add_proj'] = 'Add Project';
// Permissions
$txt['permissionname_view_todo'] = 'View To-Do List';
$txt['permissionhelp_view_todo'] = 'This permission allows users to view To-Do List.';
$txt['permissionname_add_new_todo'] = 'Can add new to-do(s)';
$txt['permissionhelp_add_new_todo'] = 'This permission allows users to can add new To-Do(s).';
// Errors
$txt['delegator_empty_fields'] = 'You left the subject/due date field(s) empty.';
$txt['cannot_view_todolist'] = 'Sorry, but you aren\'t allowed to view To-Do List.';
$txt['cannot_add_new_todolist'] = 'Sorry, but you aren\'t allowed to add new To-Do(s).';]]></add>
		</operation>
	</file>
	<!--file name="$languagedir/Modifications.slovenian.php">
		<operation>
			<search position="end" />
			<add><![CDATA[$txt['delegator'] = 'Seznam Nalog';
$txt['delegator_actions'] = 'Akcije';
$txt['delegator_empty'] = !$context['user']['is_admin'] ? 'Seznam Nalog je prazen!' : 'Seznam Nalog je prazen! Si svoboden clovek? :)';
$txt['delegator_del'] = 'Izbrisi';
$txt['delegator_subject'] = 'Naloga';
$txt['delegator_due_time'] = 'Rok';
$txt['delegator_due_year'] = 'Leto (YYYY)';
$txt['delegator_due_month'] = 'Mesec (MM)';
$txt['delegator_due_day'] = 'Dan (DD)';
$txt['delegator_priority'] = 'Pomembnost';
$txt['delegator_priority0'] = 'Nizka';
$txt['delegator_priority1'] = 'Normalna';
$txt['delegator_priority2'] = 'Visoka';
$txt['delegator_add'] = 'Dodaj';
// Permissions
$txt['permissionname_view_todo'] = 'Poglej Seznam Nalog';
$txt['permissionhelp_view_todo'] = 'S tem dovoljenjem lahko uporabniki pregledujejo Seznam Nalog.';
$txt['permissionname_add_new_todo'] = 'Lahko dodas nove Naloge.';
$txt['permissionhelp_add_new_todo'] = 'S tem dovoljenjem lahko uporabnik doda nove naloge.';
// Errors
$txt['delegator_empty_fields'] = 'Izpustil si polje za rok.';
$txt['cannot_view_todolist'] = 'Nimas dovoljenja za pregled Seznama Nalog.';
$txt['cannot_add_new_todolist'] = 'Nimas dovoljenja dodajati novih nalog.';]]></add>
		</operation>
	</file-->
</modification>
